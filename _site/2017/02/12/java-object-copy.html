

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>java对象拷贝</title>
    
    <meta name="author" content="Youly">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">Youly</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/archive">存档</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories">分类</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages">页面</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags">标签</a></li>
      	
      
    
  




            <!--
            <li><a href="/resume">简历</a></li>
            <li><a href="/photos">相册</a></li>
            -->
          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        

<div class="page-header">
  <h1>java对象拷贝 </h1>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="date">
      <span>12 February 2017</span>
    </div>
    <div class="content">
      <h3 id="section">什么是对象拷贝</h3>

<p>对象，可以简单理解为是内存区域的一段数据。对象拷贝就是把这段数据复制到内存中的另一段区域，与原来的区别是，内存地址不同。</p>

<h3 id="section-1">为什么进行对象拷贝</h3>

<p>由于对象其实是引用，在一个对象有很多引用的情况下，修改对象的属性，有很高的潜在风险。为了规避风险，提高程序确定性，拷贝是个很好的选择。</p>

<h3 id="javaclonecloneable">java中的clone、cloneable</h3>

<h4 id="clone">clone</h4>

<p>方法签名：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>protected Object clone() throws CloneNotSupportedException
</code></pre>
</div>

<ul>
  <li>
    <p>java.lang.Object类的一个实例方法，protected, 不能直接访问</p>
  </li>
  <li>
    <p>通过 field-by-field assignment 方式产生一个新的对象，不会去调用构造函数</p>
  </li>
  <li>
    <p>返回值是一个Object对象，不能直接使用，需要进行 type cast</p>
  </li>
  <li>
    <p>如果需要调用此方法，被调用类必须实现 Cloneable 接口</p>
  </li>
</ul>

<p>对于任何一个对象x，clone方法遵循如下规约：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>x.clone() != x  // always true

x.clone().getClass() == x.getClass() // true, but these are not absolute requirements

x.clone().equals(x) // be true, this is not an absolute requirement
</code></pre>
</div>

<p>以下是一个利用clone实现对象拷贝的例子：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>public class X implements Cloneable {
    public Object clone() {
        try {
       	    return super.clone();
    	} catch (CloneNotSupportedException e) {
       	    throw new InternalError(e.toString()); 
        }
    }
}
</code></pre>
</div>

<h4 id="cloneable">cloneable</h4>

<ul>
  <li>
    <p>一个没有任何method的接口，仅用来向编译器表名，一个class是否能被拷贝</p>
  </li>
  <li>
    <p>改变了java.lang.Object.clone()的行为，本来是protected的方法，却能以public的方式调用</p>
  </li>
</ul>

<h4 id="clone-1">clone方法存在的问题</h4>

<p>clone 仅仅是 field-by-field assignment，如果 field 是一个对象引用，那么赋值到新对象的也是一个引用。如何实现对象属性也能被拷贝呢？为了区别 Object.clone 的实现方式，引入一个新的概念，<font color="red"><em>Deep clone</em></font>，而 Object.clone 的实现方式叫 <font color="red"><em>Shallow clone</em></font>。两者的区别如下图：</p>

<p><img src="/assets/images/java-object-copy-1.jpg" alt="浅拷贝" />  <img src="/assets/images/java-object-copy-2.jpg" alt="深拷贝" /></p>

<p>以下是一个利用clone实现深拷贝的例子：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>public class X  implements Cloneable {
	private int a; // primitive
	private String b; // reference to immutable object
	private Y c; // where class Y has mutator methods

	public Object clone() { // deep clone
		try {
			X other = (X) super.clone(); // fields a &amp; b OK
			other.c = (Y) c.clone(); // fix c by making a copy
			return other; // return the deep clone
		} catch (CloneNotSupportedException e) {
			throw new InternalError(e.toString());
		}
	}
}
</code></pre>
</div>

<h4 id="section-2">对象拷贝最佳实践</h4>

<ul>
  <li>
    <p>不要使用java.lang.Object.clone()</p>
  </li>
  <li>
    <p>使用拷贝构造函数</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>  public Y(Y y);
</code></pre>
    </div>
  </li>
  <li>
    <p>使用静态工厂方法</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>  public static Y newInstance(Y y);
</code></pre>
    </div>
  </li>
</ul>

<h3 id="section-3">参考</h3>

<p>1、<a href="https://www.slideshare.net/fmshaon/effective-java-override-clone-method-judiciously">Effective Java - Override clone() method judiciously</a></p>

<p>2、<a href="http://www.jusfortechies.com/java/core-java/deepcopy_and_shallowcopy.php">Deep Copy And Shallow Copy</a></p>

<p>3、<a href="http://javaconceptoftheday.com/clone-method-java-lang-object-class/">clone() Method Of java.lang.Object Class</a></p>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
     
    	<li><a href="/categories.html#java-ref">
    		java <span>5</span>
    	</a></li>
    
  


    </ul>
    

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
     
    	<li><a href="/tags.html#java-ref">java <span>8</span></a></li>
    
  



    </ul>
    

    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/2015/09/26/codings-of-cards" title="银行卡身份证编码及其验证">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/2017/03/17/Rocketmq-series-introduction" title="Rocketmq系列-概念">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    


  <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
<script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script>
<script>
var cloudTieConfig = {
      url: document.location.href, 
        sourceId: "",
          productKey: "0fd00f73d0a349de8d748338ffe413a0",
            target: "cloud-tie-wrapper"
};
var yunManualLoad = true;
Tie.loader("aHR0cHM6Ly9hcGkuZ2VudGllLjE2My5jb20vcGMvbGl2ZXNjcmlwdC5odG1s", true);
</script>





  </div>
</div>


      </div>
      <hr>
      <footer>
        <p>&copy; 2017 Youly
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div>

    


  <script>
var _hmt = _hmt || [];
(function() {
      var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?8ad091ba703da2d2c2faef990fbc91f0";
          var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
})();
</script>






  </body>
</html>




<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>银行卡身份证编码及其验证</title>
    
    <meta name="author" content="Youly">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">Youly</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/archive">存档</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories">分类</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages">页面</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags">标签</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  




            <!--
            <li><a href="/resume">简历</a></li>
            -->
            <li><a href="/photos">相册</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        

<div class="page-header">
  <h1>银行卡身份证编码及其验证 </h1>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="date">
      <span>26 September 2015</span>
    </div>
    <div class="content">
      <p>最近做用户身份验证，涉及到身份证、银行卡，发现这两个都有自己的编码规则，于是记录下来。</p>

<h3 id="section">银行卡</h3>

<p>我们常见的银行卡由16位纯数字组成，如中国红十字会捐款账户 6215582201003818703。那么这一串数字由哪些部分组成呢？</p>

<p>1、IIN(Issuer identifier number)</p>

<p>前面6位表示发行者身份标识，由国际卡组织分配，其中首位是4的是VISA的卡，5是Master, 622126~622925是银联标准卡。发行者不仅仅指银行，还包含其他一些商业机构。</p>

<p>有时IIN也被指 bank identification number (bin)。这六位中的第一位又用来唯一标识卡发行者的主要行业。以下是行业对应的编码：</p>

<table>
  <thead>
    <tr>
      <th>MII digit</th>
      <th>value	Issuer category</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>ISO/TC 68 and other industry assignments</td>
    </tr>
    <tr>
      <td>1</td>
      <td>Airlines</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Airlines, financial and other future industry assignments</td>
    </tr>
    <tr>
      <td>3</td>
      <td>Travel and entertainment</td>
    </tr>
    <tr>
      <td>4</td>
      <td>Banking and financial</td>
    </tr>
    <tr>
      <td>5</td>
      <td>Banking and financial</td>
    </tr>
    <tr>
      <td>6</td>
      <td>Merchandising and banking/financial</td>
    </tr>
    <tr>
      <td>7</td>
      <td>Petroleum and other future industry assignments</td>
    </tr>
    <tr>
      <td>8</td>
      <td>Healthcare, telecommunications and other future industry assignments</td>
    </tr>
    <tr>
      <td>9</td>
      <td>For assignment by national standards bodies</td>
    </tr>
  </tbody>
</table>

<p>2、个人账户标识</p>

<p>从第二位开始至倒数第二位，有发卡行自定义，每个银行的个人账号标识规则有所不同。有的银行在这部分内容中会包含分行、支行、储蓄网点等代码信息。</p>

<p>3、校验位</p>

<p>最后一位为银行卡校验位，用来验证前面的一串数字是否为合法的卡号。校验位是如何生成的呢？</p>

<h5 id="luhm-">Luhm 校验算法</h5>

<p>1，将未带校验位的 15 位卡号从右依次编号 1 到 15，位于奇数位号上的数字乘以 2, 第 16 位是校验码</p>

<p>2，将奇位乘积的个十位全部相加，再加上所有偶数位上的数字</p>

<p>3，将加法和加上校验位能被 10 整除。</p>

<p>例如银行卡6215582201003818703，出去最后一位校验位3，其计算规则是基数位乘以2：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>6    2   1   5    5   8   2   2   0  1   0   0  3   8    1   8   7  0
</code></pre>
</div>

<hr />

<div class="highlighter-rouge"><pre class="highlight"><code>6    4   1   10   5  16   2   4   0  2   0   0  3   16   1   16  7  0
</code></pre>
</div>

<p>结果相加：</p>

<p>6 + (4) + 1 + (1 + 0) + 5 + (1 + 6) + 2 + (4) + 0 + (2) + 0 + (0) + 3 + (1 + 6) + 1 + (1 + 6) + 7 + (0) = 57</p>

<p>(57 + 3) % 10 == 0</p>

<p>php程序实现：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  public function bankcard_check($bankcard) {
    $bankcard = str_replace(' ', '', trim($bankcard));
    if (!$bankcard || !preg_match('/^\d{5,30}$/', $bankcard)) {
        return FALSE;
    }
    $checkcode = substr($bankcard, -1);
    $bankcard = substr($bankcard, 0, -1);
    $len = strlen($bankcard);
    $luhm_sum = 0;
    $j = 1;
    for ($i = $len - 1; $i &gt;= 0; $i--)  {
        $k = intval($bankcard[$i]);
        if ($j % 2 == 1) {
            $k *= 2;
            $k = intval($k / 10) + $k % 10;
        }

        $luhm_sum += $k;
        $j++;
    }
    if (($luhm_sum + $checkcode) % 10 == 0) {
        return $bankcard . $checkcode;
    }
    return FALSE;
}
</code></pre>
</div>

<h5 id="section-1">附</h5>

<p><a href="/assets/files/banks.php.txt">银行列表</a>，不是最新的，但包含大多数银行，可参考。</p>

<h3 id="section-2">身份证</h3>

<p>中国公民第二代身份证由18位数字字符组成，分成四个部分：</p>

<p>1、地址码</p>

<p>表示编码对象常住户口所在县（市、旗、区）的行政区划代码，省市区都是两位</p>

<p>省编码：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$city = array(
	11 =&gt; "北京",
	12 =&gt; "天津",
	13 =&gt; "河北",
	14 =&gt; "山西",
	15 =&gt; "内蒙古",
	21 =&gt; "辽宁",
	22 =&gt; "吉林",
	23 =&gt; "黑龙江",
	31 =&gt; "上海",
	32 =&gt; "江苏",
	33 =&gt; "浙江",
	34 =&gt; "安徽",
	35 =&gt; "福建",
	36 =&gt; "江西",
	37 =&gt; "山东",
	41 =&gt; "河南",
	42 =&gt; "湖北",
	43 =&gt; "湖南",
	44 =&gt; "广东",
	45 =&gt; "广西",
	46 =&gt; "海南",
	50 =&gt; "重庆",
	51 =&gt; "四川",
	52 =&gt; "贵州",
	53 =&gt; "云南",
	54 =&gt; "西藏",
	61 =&gt; "陕西",
	62 =&gt; "甘肃",
	63 =&gt; "青海",
	64 =&gt; "宁夏",
	65 =&gt; "新疆",
	71 =&gt; "台湾",
	81 =&gt; "香港",
	82 =&gt; "澳门",
	91 =&gt; "国外"
);
</code></pre>
</div>

<p>2、出生日期码</p>

<p>表示编码对象出生的年、月、日，年（YYYY)，月(mm), 日(dd)</p>

<p>3、顺序码</p>

<p>表示在同一地址码所标识的区域范围，对同年、同月、同日出生的人编定的顺序号，顺序码奇数分配给男性，偶数分配给女性。</p>

<p>4、校验码</p>

<p>生成规则遵循 <a href="https://en.wikipedia.org/wiki/ISO_7064">iso7064</a> mod11-2</p>

<p>十七位数字本体码加权求和公式：</p>

<p>S= SUM(Ai * Wi), i=0, … , 16</p>

<p>Ai：表示第i位置上的身份证号码数字值</p>

<p>Wi：表示第i位置上的加权因子，值为：[7 9 10 5 8 4 2 1 6 3 7 9 10 5 8 4 2]</p>

<p>S对11取模，得到一个校验码索引，根据索引可得到校验码的值：[1 0 X 9 8 7 6 5 4 3 2]</p>

<p>php代码校验：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>function id_number_check($number) {
	if (!preg_match('/^(\d{6})(19|20)?(\d{2})([01]\d)([0123]\d)(\d{3})(\d|x)?$/i', $number)) {
		return FALSE;
	}

	// $city 变量上面已定义
	if (empty($city[substr($number, 0, 2)])) {
		return FALSE;
	}
	// 加权因子
	$factor = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2];
	// 校验位
	$parity = [1, 0, 'X', 9, 8, 7, 6, 5, 4, 3, 2];
	$sum = 0;
	$ai = 0;
	$wi = 0;
	for ($i = 0; $i &lt; 17; $i++) {
		$ai = $number[$i];
		$wi = $factor[$i];
		$sum += $ai * $wi;
	}
	$last = $parity[$sum % 11];
	if ($last != $number[17]) {
		return FALSE;
	}
	return TRUE;
}
</code></pre>
</div>

<h3 id="section-3">参考</h3>

<p>1、<a href="https://en.wikipedia.org/wiki/ISO/IEC_7812">ISO/IEC_7812</a></p>

<p>2、<a href="http://blog.sina.com.cn/s/blog_12fc3a84d0101u7o8.html">银行卡编码规则</a></p>

<p>3、<a href="http://vdisk.weibo.com/s/tFDQbBuhBAKN?from=page_100505_profile&amp;wvr=6">GB 11643-1999</a></p>


    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
     
    	<li><a href="/categories.html#设计-ref">
    		设计 <span>6</span>
    	</a></li>
    
  


    </ul>
    

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
     
    	<li><a href="/tags.html#php-ref">php <span>5</span></a></li>
     
    	<li><a href="/tags.html#编码-ref">编码 <span>2</span></a></li>
    
  



    </ul>
    

    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/2015/06/06/rabbitmq-cluster-with-high-availability-2" title="使用rabbitmq提供高可用性队列服务(2)">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/2017/02/12/java-object-copy" title="java对象拷贝">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    


  <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
<script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script>
<script>
var cloudTieConfig = {
      url: document.location.href, 
        sourceId: "",
          productKey: "0fd00f73d0a349de8d748338ffe413a0",
            target: "cloud-tie-wrapper"
};
var yunManualLoad = true;
Tie.loader("aHR0cHM6Ly9hcGkuZ2VudGllLjE2My5jb20vcGMvbGl2ZXNjcmlwdC5odG1s", true);
</script>





  </div>
</div>


      </div>
      <hr>
      <footer>
        <p>&copy; 2017 Youly
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div>

    

  </body>
</html>

